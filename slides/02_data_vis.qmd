---
title: "EVR 628 - Intro to Environmental Data Science"
subtitle: "Data visualization"
---

```{r}
#| include: false
suppressPackageStartupMessages({
  library(tidyverse)
  library(EVR628tools)
  library(knitr)
})

data_lionfish <- data_lionfish |> 
  mutate(size_class = case_when(total_length_mm < 100 ~ "small",
                                between(total_length_mm, 100, 200) ~ "medium",
                                total_length_mm > 200 ~ "large"))

theme_set(
  theme_bw(base_size = 20)
)
```

## Learning objectives

:::{.callout-note}
# By the end of this week, you should be able to:
- Identify types of data
- Use correct jargon when referring to data
- Decide which types of visualizations are better suited for different types of data
- Build a figure using `ggplot2`
:::


# Types of visualization

## Types of data

The _type_ of data you have can influence how you visualize them

- Numerical: (AKA "quantitative") a measurement expressed in numbers, instead of words
    - Discrete numerical: Counts, integer numbers
    - Continuous numerical: Think decimal numbers
- Categorical: (AKA "qualitative") a measurement expressed in words, instead of numbers (often)
- Ordinal: A special type of cetegorical data, where the order of the categories has a meaning

## Examples: lionfish biometry

![](img/lionfish.JPG){.nostretch fig-align="center" width="40%"}

- `data_lionfish`, from the `EVR628tools` package
- contains biometric measurements for 109 lionfish (_Pterois volitans_) captured off Puerto Aventuras (Mexico)

. . .

:::: {.callout-tip}
Use `?data_lionfish` to look at the [documentation](https://jcvdav.github.io/EVR628tools/reference/data_lionfish.html).
::::

## Examples: lionfish biometry

```{r}
#| folding: true
data_lionfish[1:6,c(1:2, 5, 9)] |> 
  kable()
```

. . .

What type of data is `id`?

. . . 

How about `total_length_mm`?

. . .

And `size_class`?


## Example: Huricane tracks

```{r}
data_milton |> 
  select(name, iso_time, lat, lon, sshs) |> 
  head(10) |> 
  tail(5) |> 
  knitr::kable()
```

. . .

What type of data is `sshs`?

. . .

:::: {.callout-tip}
Use `?data_milton` to look at the [documentation](https://jcvdav.github.io/EVR628tools/reference/data_milton.html).
::::

. . .

Can you add `sshs` and obtain something meaningful?


## Some jargon

- Variable: A measurable quality, quantity or property
- Value: The state of the variable
- Observation: A data point to which variables and values are assigned
- _Tabular_ data: The way we store and represent information. Allows us to relate a variable (column) to an observation (row)

. . .

:::: {.columns}
::: {.column width="60%"}

```{r}
#| folding: true
data_lionfish[1:3,c(2, 5:6)] |> 
  kable()
```
:::
::: {.column width="40%"}
- Which of these is a variable?
- A value of that variable?
- How many observations?
:::
::::


## Types of visualizations

There are many, many, MANY types of visualizations:

- scatter plot, column chart (stacked columns, dodge columns), histogram, 2d-histogram, violin plots, boxplots, pie charts (eww), heatmaps, line graphs, area charts, stacked area, density, voronoi plots, alluvial diagrams...

. . . 

But what really matters:

- You want your _type_ of data to match your _type_ of visualization
- Some data types may be "incompatible" with some visualizations
- You should have creative freedom
- We have one goal: To communicate something to the viewer (our ourselves)

<!-- k -->

## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm)) +
  geom_histogram(bins = 8, color = "black") +
  labs(x = "Total length (mm)",
       y = "N")
```

Message: "Most lionfish are around 100 mm in length"

:::

::: {.column width="40%"}
### [Histogram:]{style="color:green"}
- Shows two numeric variables
  - Binned continuous
  - Counts within each bin
- Shows the _distribution_ of the data
- Built with `ggplot2::geom_histogram()`
:::
::::

. . .

:::: {.callout-tip}
Every histogram is a bar chart, but not every bar chart is a histogram
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = site, y = total_weight_gr)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Site",
       y = "Total weight (gr)")
```

Message: "Tzimin-Ha has the heaviest fish"

:::

::: {.column width="40%"}
### [Boxplot:]{style="color:green"}
- _Distribution_ of a continuous variable by groups
- Line inside box shows median
- Outlines of box show 25th and 75th percentiles
- Whiskers extend from hinge to the largest value within $1.5 \times IQR$ from the hinge
- Points are "outlying" observations
:::
::::

:::: {.callout-tip}
Use this one with care. It packs a lot of information and not everyone knows (remembers) how to read it.
::::

## Examples

:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm,
                     y = total_weight_gr)) +
  geom_point() +
  labs(x = "Total length (mm)",
       y = "Total weight (gr)")
```
Message: "Look, slightly larger fish are waaaay heavier!"

:::

::: {.column width="40%"}
### [Scatterplot:]{style="color:blue"}
- Relationship between two numeric variables
- Represented with points
- Uses `ggplot2::geom_point()`
:::
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_milton, 
       mapping = aes(x = iso_time, y = wind_speed)) +
  geom_line() +
  labs(x = "Date",
       y = "Wind speed (knots)")
```

Message: "The wind speed of a hurricane was highest the night of Oct 7th"

:::

::: {.column width="40%"}
### [Line chart:]{style="color:red"}
- Evolution of one variable along another
- Conveys a sense of continuity even if our observations are not
- Uses `ggplot::geom_line()`
:::
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
      mapping = aes(x = site)) +
  geom_bar() +
  coord_flip() +
  labs(x = "Site",
       y = "N")
```

Message: "Most fish come from Paamul"

:::

::: {.column width="40%"}
### [Column:]{style="color:gray"}
- Relationship between categorical and numeric variable
- Represented with "columns" or "bars"
- This case uses `ggplot2::geom_bar()`, but there is also `ggplot2::geom_col()`
:::
::::


## Now I'm confused...

- Good!
- That confusion might be critical thinking
- You can always try visualizing the same data in more than one way
- Let's try to organize your thoughts

## Right visuals for your data

Remember our goal:

> To communicate something to the viewer (our ourselves)

. . .

That _something_ could be a:

- [Distribution]{style="color:green"}: "Most of my fish are quite small" ([example](#examples))

- [Relationship]{style="color:blue"} (or correlation): "Look, slightly larger fish are waaaay heavier!" ([example](#examples-2))

- [Evolution]{style="color:red"}: "The wind speed of a hurricane was highest the night of Oct 7th"([example](#examples-3))

- [Ranking / Part of a whole]{style="color:gray"}: "Most fish come from Paamul"([example](#examples-5))

. . .

Any visual can usually achieve more than one of this at a time

. . .

Most visuals can only achieve _one_ of these at a time

# Lets go back to the [examples](#examples)

## Some visuals are more than one type
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = size_class, y = site)) +
  geom_bin_2d() +
  labs(x = "Size class",
       y = "Site")
```

Message: "Most fish are medium sized and come from Paamul"

:::

::: {.column width="40%"}
### [Heatmap:]{style="color:green"}
- Shows counts across two variables at the same time
- Uses `ggplot2::geom_bin_2d()`

:::
::::

. . .

:::: {.callout-important}
# Is my x-axis bothering you?
R does not know that there is a logical order (small -> medium -> large).
::::


# Just because you can doesn't mean you should

## Is this good or bad?

```{r}
p <- ggplot(data = data_lionfish,
       aes(x = site,
           y = total_length_mm)) +
  labs(x = "Site",
       y = "Total length (mm)")

p +
  geom_point()
```

## Is this better or worse?

```{r}
p +
  geom_jitter(height = 0, width = 0.25)
```

## How about now?

```{r}
p +
  geom_boxplot()
```


## Resources
- [data-to-viz](https://www.data-to-viz.com/) resources
- _A checklist for designing and improving the visualization of scientific data_ by @Jambor2025-pd



# Visualization principles

- There are only two rules:
  - Transparency (don't hide or manipulate data, or be clear about how you do so)
  - Clarity (get your message through)

# Other considerations (contrast, colorblindness, standards)

IPCCâ€™s visual style guide, and the [`viridis`](https://github.com/sjmgarnier/viridis/) package

# THE grammar of graphics
The grammar of graphics and the [`ggplot2`](https://github.com/tidyverse/ggplot2) package



