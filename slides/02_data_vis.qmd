---
subtitle: "Week 2: Data visualization"
---

```{r}
#| include: false
suppressPackageStartupMessages({
  library(tidyverse)
  library(ggrepel)
  library(ggtext)
  library(EVR628tools)
  library(knitr)
})

theme_set(
  theme_bw(base_size = 20)
)
```

## Learning Objectives

:::{.callout-note}
# By the end of this week, you should be able to:
- Identify types of data
- Use correct jargon when referring to data
- Decide which types of visualizations are better suited for different types of data
- Build a figure using `ggplot2`
:::


# Types of data

## Some Jargon

- Variable: A measurable quality, quantity or property
- Value: The state of the variable
- Observation: A data point to which variables and values are assigned
- _Tabular_ data: The way we store and represent information. Allows us to relate a variable (column) to an observation (row)

. . .

:::: {.columns}
::: {.column width="60%"}

```{r}
#| folding: true
data_lionfish[1:3,c(1, 5)] |> 
  kable()
```
:::
::: {.column width="40%"}
- Which of these is a variable?
- A value of that variable?
- How many observations?
:::
::::

## Types of Data

The _type_ of data you have can influence how you visualize them

- Numerical: (AKA "quantitative") a measurement expressed in numbers, instead of words
    - Discrete numerical: Counts, integer numbers
    - Continuous numerical: Think decimal numbers
- Categorical: (AKA "qualitative") a measurement expressed in words, instead of numbers (often)
- Ordinal: A special type of cetegorical data, where the order of the categories has a meaning

## Examples: Lionfish Biometry

![](img/lionfish.JPG){.nostretch fig-align="center" width="40%"}

- `data_lionfish`, from the [`EVR628tools`](https://jcvdav.github.io/EVR628tools/index.html) package
- Contains biometric measurements for 109 lionfish (_Pterois volitans_) captured off Puerto Aventuras (Mexico)

. . .

:::: {.callout-tip}
Use `?data_lionfish` to look at the [documentation](https://jcvdav.github.io/EVR628tools/reference/data_lionfish.html).
::::

## Examples: Lionfish Biometry

```{r}
#| folding: true
data_lionfish[1:6,c(1, 2, 5, 9)] |> 
  kable()
```

. . .

What type of data is `id`?

. . . 

How about `total_length_mm`?

. . .

And `size_class`?


## Example: Hurricane Tracks

```{r}
data_milton |> 
  select(name, iso_time, lat, lon, sshs) |> 
  head(10) |> 
  tail(5) |> 
  knitr::kable()
```

. . .

What type of data is `sshs`?

. . .

:::: {.callout-tip}
Use `?data_milton` to look at the [documentation](https://jcvdav.github.io/EVR628tools/reference/data_milton.html).
::::

. . .

Can you add `sshs` and obtain something meaningful?

# Types of visualizations

## Types of Visualizations

There are many, many, MANY types of visualizations:

- scatter plot, column chart (stacked columns, dodge columns), histogram, 2d-histogram, violin plots, boxplots, pie charts (eww), heatmaps, line graphs, area charts, stacked area, density, voronoi plots, alluvial diagrams...

. . . 

But what really matters:

- You want your _type_ of data to match your _type_ of visualization
- Some data types may be "incompatible" with some visualizations
- You should have creative freedom
- We have one goal: To communicate something to the viewer (our ourselves)

## Visualizing for Yourself

![Modified from @Wickham2023-aa](https://r4ds.hadley.nz/diagrams/data-science/base.png){.nostretch fig-align="center" width="95%"}

## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm)) +
  geom_histogram(bins = 8, color = "black") +
  labs(x = "Total length (mm)",
       y = "N",
       title = "Distribution of lionfish size")
```

Message: "Most lionfish are around 100 mm in length"

:::

::: {.column width="40%"}
### [Histogram:]{style="color:green"}
- Shows two numeric variables
  - Binned continuous
  - Counts within each bin
- Shows the _distribution_ of the data
- Built with `ggplot2::geom_histogram()`
:::
::::

. . .

:::: {.callout-tip}
Every histogram is a bar chart, but not every bar chart is a histogram
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = site, y = total_weight_gr)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Site",
       y = "Total weight (gr)",
       title = "Distribution of lionfish size by\nsampling site")
```

Message: "Tzimin-Ha has the heaviest fish"

:::

::: {.column width="40%"}
### [Boxplot:]{style="color:green"}
- _Distribution_ of a continuous variable by groups
- Line inside box shows median
- Outlines of box show 25th and 75th percentiles
- Whiskers extend from hinge to the largest value within $1.5 \times IQR$ from the hinge
- Points are "outlying" observations
:::
::::

. . .

:::: {.callout-tip}
Use this one with care. It packs a lot of information and not everyone knows (remembers) how to read it.
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = size_class, y = site)) +
  geom_bin_2d() +
  labs(x = "Size class",
       y = "Site",
       fill = "N",
       title = "Distribution of observations\nacross sites and sizes")
```

Message: "Most fish are medium sized and come from Paamul"

:::

::: {.column width="40%"}
### [Heatmap:]{style="color:green"}
- Shows counts across two variables at the same time
- Uses `ggplot2::geom_bin_2d()`

:::
::::

. . .

:::: {.callout-important}
# Is my x-axis bothering you?
R does not know that there is a logical order (small -> medium -> large).
::::


## Examples

:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm,
                     y = total_weight_gr)) +
  geom_point() +
  labs(x = "Total length (mm)",
       y = "Total weight (gr)",
       title = "Relationship between lionfish length\nand weight")
```
Message: "Look, slightly larger fish are waaaay heavier!"

:::

::: {.column width="40%"}
### [Scatterplot:]{style="color:blue"}
- Relationship between two continuous numeric variables
- Represented with points
- Uses `ggplot2::geom_point()`
:::
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
ggplot(data = data_milton, 
       mapping = aes(x = iso_time, y = wind_speed)) +
  geom_line() +
  labs(x = "Date",
       y = "Wind speed (knots)",
       title = "Evolution of wind speed for\nHurricane Milton")
```

Message: "The wind speed of a hurricane was highest the night of Oct 7th"

:::

::: {.column width="40%"}
### [Line chart:]{style="color:red"}
- Evolution of one variable along another
- Conveys a sense of continuity even if our observations are not
- Uses `ggplot::geom_line()`
:::
::::


## Examples
:::: {.columns}
::: {.column width="60%"}
```{r}
data_lionfish |> 
  group_by(site) |> 
  summarize(largest = max(total_length_mm)) |> 
  ggplot(mapping = aes(x = site, y = largest)) +
  geom_col() +
  coord_flip() +
  labs(x = "Site",
       y = "Largest fish (mm)",
       title = "Size of largest fish by site")
```

Message: "Largest fish comes from Castillo"

:::

::: {.column width="40%"}
### [Column:]{style="color:gray"}
- Relationship between categorical and numeric variable
- Represented with "columns" or "bars"
- This case uses `ggplot2::geom_col()`, but there is also `ggplot2::geom_bar()`
:::
::::

## Now I'm confused...

- Good!
- That confusion might be critical thinking
- You can always try visualizing the same data in more than one way
- Let's try to organize your thoughts

## Right Visuals for Your Data

Remember our goal:

> To communicate _something_ to the viewer (our ourselves)

. . .

That _something_ could be a:

- [Distribution]{style="color:green"}: "Most of my fish are quite small" ([example](#examples))

- [Relationship]{style="color:blue"} (or correlation): "Look, slightly larger fish are waaaay heavier!" ([example](#examples-3))

- [Evolution]{style="color:red"}: "The wind speed of a hurricane was highest the night of Oct 7th"([example](#examples-4))

- [Ranking / Part of a whole]{style="color:gray"}: "Largest fish comes from Castillo"([example](#examples-6))

. . .

Any visual can usually achieve more than one of this at a time

. . .

Most visuals can only achieve _one_ of these _effectively_ at a time

## Same Data, Multiple Plots

Which of this is best at showing the relationship between size and weight?

. . .

:::: {.columns}
::: {.column width="50%"}

```{r}
#| fig-width: 3
#| fig-height: 2
#| echo: false
p <- ggplot(data = data_lionfish,
            mapping = aes(x = total_length_mm, total_weight_gr)) +
  labs(x = "Total length (mm)",
       y = "Total weight (gr)") +
  theme_bw()

p + geom_point()

p + geom_line()
```
:::

::: {.column width="50%"}
```{r}
#| fig-width: 3
#| fig-height: 2
#| echo: false
p + geom_col()

```

```{r}
#| fig-width: 3.87
#| fig-height: 2
#| echo: false
p + geom_bin_2d(bins = 10) + labs(fill = "N")
```

:::
::::

. . .

Which one is best at showing the size and weight of most fish?


## Same Data, Multiple Plots

Which is best at shwoing me the number of samples by site and size?

. . . 

:::: {.columns}
::: {.column width="50%"}
```{r}
#| fig-width: 5
#| fig-height: 2.75
#| echo: false
p <- ggplot(data = data_lionfish,
            aes(x = site, y = size_class)) +
  coord_flip() +
  labs(x = "Site",
       y = "Size class")

p + geom_point()

```

```{r}
#| fig-width: 6.5
#| fig-height: 2.75
#| echo: false
p + geom_bin2d(bins = 10) + labs(fill = "N")
```


:::

::: {.column width="50%"}
```{r}
#| fig-width: 5
#| fig-height: 2.75
#| echo: false
p + geom_line(aes(group = site))

p + geom_line(aes(group = size_class))
```

:::
::::


## Choosing the "Right" Visual

- The right visual is the one that gets the message across

- Ask yourself some questions:
  - How many variables do I want to represent?
  - What type of data do I have for each variable?
  - What pattern or message do I want to convey?

- There are resources to help you brainstorm:
  - [r-graph-gallery](https://r-graph-gallery.com/)
  - [data-to-viz](https://www.data-to-viz.com/)
  - What others in your field do


# Principles of visualization

## Principles of Visualization

You know what _type_ of graph you want, lets make it pretty

. . .

Small parentheses: "Add lightness"

![Source: Diseno-art.com](img/mx5.jpg){.nostretch fig-align="center" width="40%"}

. . .

Instead  of thinking "what can I _add_ to my plot?" think "what can I _remove_ from my plot?

## @Jambor2025-pd's Guide to Visualization

- [Simplify](#simplify): Improving annotations, labels, and layouts helps you retain the audience's attention
- [Text](#text): Appropriate font size, avoid non-horizontal text. **Axis labels with units!!**
- [Color scheme:](#color-scheme)
  - Prioritize accessibility and **consistency**
  - Don't abuse color; Use only when you must draw attention
- If you absolutely need color, consider data encoding:
  - [categorical](#categorical): Use a discrete color palette (e.g. `EVR628tools::palette_UM()`)
  - [sequential](#sequential) (i.e. ordinal and numeric): single hue with varying saturation (e.g. ) or multihue _designed_ for sequential (e.g. `viridis` colors)
  - [diverging](#diverging) data: two contrasting hues and neutral center is better than a single hue or multihues

## Simplify

:::: {.columns}

::: {.column width="50%"}

```{r}
p <- ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm,
                     y = total_weight_gr)) +
  geom_point()

p +
  theme_gray() +
  scale_x_continuous(breaks = seq(0, 350, by = 15),
                     limits = c(0, 350)) +
  scale_y_continuous(breaks = seq(0, 400, by = 20),
                     limits = c(0, 400)) +
  theme(axis.line = element_line(color = "black"),
        panel.grid = element_line(color = "black")) +
  labs(title = "Total length (mm) vs total weight (gr) for 109 lionfish sampled from Mexico",
       subtitle = "Note that the largest fish is not the heaviest fish")


```

:::

::: {.column width="50%"}

```{r}
#| fig-width: 5
#| fig-height: 4
longest <- data_lionfish |> slice_max(total_length_mm)
heaviest <- data_lionfish |> slice_max(total_weight_gr)

p + 
  geom_text_repel(data = longest,
                  label = "Longest",
                  nudge_x = -5,
                  nudge_y = -150,
                  size = 5) +
  geom_text_repel(data = heaviest,
                  label = "Heaviest",
                  nudge_x = -50,
                  nudge_y = -10,
                  size = 5) +
  theme_minimal(base_size = 14) +
  theme(axis.text = element_text(color = "black", size = 10),
        axis.title = element_text(color = "black", size = 12)) +
  labs(x = "Total length (mm)",
       y = "Total weight (gr)") +
  labs(title = "There's always a bigger fish",
       subtitle = "The largest fish is not the heaviest fish")
```

:::
::::

## Text

:::: {.columns}
::: {.column width="50%"}
```{r}
#| fig-width: 6
#| fig-height: 3
p <- ggplot(data = data_lionfish,
       mapping = aes(x = site)) +
  geom_bar() +
  labs(x = "Site", y = "N")

p
```

```{r}
#| fig-width: 12
#| fig-height: 3
p +
  theme_bw(base_size = 12)
```


:::

::: {.column width="50%"}

```{r}
#| fig-width: 6
#| fig-height: 2.5
p +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
#| fig-width: 6
#| fig-height: 3
p +
  coord_flip()
```

:::
::::


## Color Scheme

:::: {.columns}
::: {.column width="50%"}
```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = site, fill = site)) +
  geom_bar() +
  coord_flip() +
  labs(x = "Site",
       y = "N",
       title = "Most samples come from Paamul\n(N = 31; teal)")
```
:::
::: {.column width="50%"}

```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = site, fill = site == "Paamul")) +
  geom_bar() +
  scale_fill_manual(values = c("FALSE" = "gray",
                               "TRUE" = "darkred")) +
  coord_flip() +
  labs(x = "Site", y = "N",
       title = "N = 31 come from <span style='color:darkred;'>Paamul</span>") +
  theme(plot.title = element_markdown(),
        axis.title.y = element_markdown(),
        legend.position = "None") +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, 32))
```
:::
::::

. . .

Do you really need to use color?

. . . 

Use better colors

. . .

Avoid redundant use of your limited aesthetics (x, y, size, color, shape)

## Categorical

:::: {.columns}
:::: {.column width="50%"}

```{r}
#| echo: false
p <- ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm,
                     y = total_weight_gr,
                     fill = site)) +
  geom_point(color = "black",
             shape = 21,
             size = 3) +
    labs(x = "Total length (mm)",
       y = "Total weight (gr)",
       fill = "Site")
```


```{r}
p +
  scale_fill_grey()
```
:::
:::: {.column width="50%"}

```{r}
p +
  scale_fill_manual(values = palette_UM(10))
```
:::
::::

. . .

Use a discrete color palette for categorical data

. . .

It is difficult to track more than  (6) 10 colors

. . .

These colors come from [`EVR628tools::palette_UM()`](https://jcvdav.github.io/EVR628tools/reference/palette_UM.html), using [UM's visual style guide](https://webcomm.miami.edu/resources/identity/color/index.html)

## Sequential

```{r}
#| echo: false
p <- ggplot(data = data_lionfish,
            mapping = aes(x = size_class, y = site)) +
  geom_bin_2d() +
  labs(x = "Size class",
       y = "Site",
       fill = "N")

p2 <- ggplot(data = data_lionfish |> 
               mutate(size_class = fct_relevel(size_class, c("small", "medium", "large"))),
             mapping = aes(x = site,
                           fill = size_class)) +
  geom_bar(position = "dodge",
           color = "black") +
  coord_flip() +
  labs(x = "Site",
       y = "N",
       fill = "Size class")
  
```


:::: {.columns}

::: {.column width='33%'}
Diverging palette

```{r}
p +
  scale_fill_gradientn(colors = palette_IPCC())

p2 +
  scale_fill_manual(values = unname(palette_IPCC()[c(1, 128, 256)]))
```

:::

::: {.column width='33%'}

Multihue palette

```{r}
p +
  scale_fill_viridis_c()

p2 + 
  scale_fill_viridis_d()
```


:::

::: {.column width='33%'}
Single hue palette
```{r}
p +
  scale_fill_distiller(palette = "Blues")

p2 +
  scale_fill_brewer(palette = "Blues")
```
:::

::::

## Diverging

```{r}
#| echo: false
my_sst <- data_sst |> 
  mutate(month = month(date, label = TRUE, abbr = TRUE),
         year = year(date)) |> 
  group_by(year, month) |> 
  summarize(SST = mean(temperature_C),
            .groups = "drop")
```


:::: {.columns}

::: {.column width='50%'}
```{r}
#| fig-width: 9.5
#| fig-height: 4
p <- ggplot(data = my_sst,
            mapping = aes(x = month, y = year,
                          fill = SST - mean(SST))) +
  geom_tile() +
  # theme(legend.position = "top", legend.title.position = "top") +
  labs(x = "Month", y = "Year", fill = "SST Anomaly (Â°C)")

p
```

:::

::: {.column width='50%'}
```{r}
#| fig-width: 9.5
#| fig-height: 4
p +
  scale_fill_gradientn(colours = palette_IPCC(var = "temp", type = "div"))

p +
  scale_fill_gradientn(colours = palette_IPCC(var = "temp", type = "seq"))
```

:::
::::


## Other Ways of Representing Information


:::: {.columns}

::: {.column width='40%'}
- We've tried position (horizontal and vertical) and color
- There is also:
  - size
  - shape
  - aspect (line width, line type)
- Our brains struggle to compare sizes
- We can only track ~6 shapes at a time
- Avoid using these for your most important message
:::

::: {.column width='60%'}

```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = total_length_mm, y = total_weight_gr, color = depth_m, size = fct_relevel(size_class, c("small", "medium", "large")), shape = site)) +
  geom_point() +
  labs(x = "Total length (mm)",
       y = "Total weight (gr)",
       color = "Site",
       shape = "Site",
       size = "Size class") +
  scale_shape_manual(values = c(1:10))
```
:::

::::


## Resources on Style  
- _A [checklist](https://static-content.springer.com/esm/art%3A10.1038%2Fs41556-025-01684-z/MediaObjects/41556_2025_1684_MOESM1_ESM.pdf) for designing and improving the visualization of scientific data_ by @Jambor2025-pd

# Intro to `ggplot2`

## The Grammar of Graphics

Grammar:

- Set of rules that define components of a language

. . .

Grammar of graphics:

- Proposed by Leland Wilkinson in 2005
- Framework that enables description of components of _any_ graph
- It is NOT a framework for _effective_ visualization

. . .

`ggplot2`:

- Developed by Hadley Wickham
- Leverages the _layerd grammar of graphics_ proposed in @layered-grammar
- Focuses on a layered approach to describe and construct graphs
- Most of the time you will work with `aes`thetic mappings and `geom`etric objects

## Requirements

```{r}
#| echo: false
rm(data_lionfish)
theme_set(theme_gray())
```


You will need to load two packages

```{r}
#| code-fold: false
library(EVR628tools)
library(tidyverse)
```


## Goal

Recall the `data_lionfish` data:
```{r}
#| code-fold: false
glimpse(data_lionfish)
```

## Goal

```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 4
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m,
                     y = total_length_mm)) +
  geom_point(shape = 21,
             fill = "steelblue",
             size = 2) +
  labs(x = "Depth (m)",
       y = "Total weight (gr)",
       title = "Body length and depth",
       subtitle = "Larger fish tend to live deeper",
       caption = "Source EVR628tools::data_lionfish")
```

## Steps to Build a Plot with `ggplot2`

1. Specify your data
2. Specify your x (and y) axis `aes`thetic mappings
3. Specify your `geom`etric representation
4. Modify geoms as needed
5. Modify your labels as needed

## 1. Specify the Data

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
ggplot(data = data_lionfish)
```

## 2. Specify the `aes`thetics

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
#| code-line-numbers: "2"
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m))
```

## 2. Specify the `aes`thetics

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
#| code-line-numbers: "2"
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm))
```

## 3. Specify the `geom`etric Representation

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
#| code-line-numbers: "3"
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm)) +
  geom_point()
```

## 5. Modify Geoms as Needed

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
#| code-line-numbers: "3"
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm)) +
  geom_point(shape = 21, fill = "steelblue", size = 2)
```

## 4. Modify Labels as Needed

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
#| code-line-numbers: "4"
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm)) +
  geom_point(shape = 21, fill = "steelblue", size = 2) +
  labs(x = "Depth (m)")
```

## 4. Modify Labels as Needed

```{r}
#| code-fold: false
#| fig-width: 6
#| fig-height: 4
#| code-line-numbers: "4-8"
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm)) +
  geom_point(shape = 21, fill = "steelblue", size = 2) +
  labs(x = "Depth (m)",
       y = "Total length (mm)",
       title = "Body length and depth",
       subtitle = "Larger fish tend to live deeper",
       caption = "Source EVR628tools::data_lionfish")
```

## Resources

- `ggplot2` [cheatsheet](https://rstudio.github.io/cheatsheets/data-visualization.pdf)
- Package [vignettes](https://ggplot2.tidyverse.org/articles/ggplot2-specs.html)
- @layered-grammar

## Learning Objectives - Revisited

:::{.callout-note}
# By the end of this week, you should be able to:
- Identify types of data
- Use correct jargon when referring to data
- Decide which types of visualizations are better suited for different types of data
- Build a figure using `ggplot2`
:::

# Let's get coding

# References 




