---
title: "Using `ggplot2`"
lightbox: true
format:
  html:
    toc: true
    code-fold: true
  pdf:
    documentclass: article
---

# Part 1: Build a basic plot


- Open RStudio
- Make sure you are in the EVR628 project
- Create a new script, and save it to scripts as `week2_ggplot.R`
- Add a basic descriptive header
- Load packages

```{r}
library(EVR628tools)
library(tidyverse)
```

- Inspect data

```{r}
glimpse(data_lionfish)
```

## The `ggplot` function

- Show documentation: point out data and mapping
- Specify data

```{r}
ggplot(data = data_lionfish)
```

## The `aes` function
- Show documentation
- A function inside a function
- Then specify mapping
- Emphasis of use of commas and named arguments
- Show what happens when you don't name arguments
- Multiple lines and parentheses

```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm))
```

## The `geom_point` function
- Emphasiz on `+` for layering
- Run with simple points
- Show documentation and scroll down to the **Aesthetics** section
- Show how to change colors / sizes etc...
- Emphasize difference between using variables and constant values (inside vs outisde aes)

```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m, y = total_length_mm)) +
  geom_point()
```

## `labs` function

```{r}
ggplot(data = data_lionfish,
       mapping = aes(x = depth_m,
                     y = total_length_mm)) +
  geom_point(shape = 21,
             fill = "steelblue",
             size = 2) +
  labs(x = "Depth (m)",
       y = "Total weight (gr)",
       title = "Body length and depth",
       subtitle = "Larger fish tend to live deeper",
       caption = "Source EVR628tools::data_lionfish")
```

# Part 2: Visualizing distributions

- Categorical variable with `geom_bar()`
  - basic with site
  - with `fct_infreq` and site

```{r}
# Basic bar plot with site
ggplot(data = data_lionfish, aes(x = site)) +
  geom_bar() +
  coord_flip() +
  labs(x = "Site", y = "Number of fish")

# Bar plot with sites ordered by frequency
ggplot(data = data_lionfish, aes(x = fct_infreq(site))) +
  geom_bar() +
  coord_flip() +
  labs(x = "Site", y = "Number of fish")
```
- Numerical variable with `geom_histogram()`
  - Distribution of lengths

```{r}
# Histogram of lengths
ggplot(data = data_lionfish, aes(x = total_length_mm)) +
  geom_histogram(bins = 15, fill = "steelblue", color = "black") +
  labs(x = "Total length (mm)", y = "Count")
```


# Part 3: Visualizing relationships
- A numerical and a categorical variable : depth by size class
- Two categorical variables: N by size class and site
- Two numerical variables: depth vs temp
- Three or more: length vs depth with size for weight and color for temp

```{r}
# Numerical vs categorical: depth by size class
ggplot(data = data_lionfish, aes(x = size_class, y = depth_m)) +
  geom_boxplot() +
  labs(x = "Size class", y = "Depth (m)")

# Two categorical variables: N by size class and site
ggplot(data = data_lionfish, aes(x = site, fill = size_class)) +
  geom_bar(position = "dodge") +
  coord_flip() +
  labs(x = "Site", y = "Number of fish", fill = "Size class")

# Two numerical variables: depth vs temperature
ggplot(data = data_lionfish, aes(x = depth_m, y = temperature_C)) +
  geom_point() +
  labs(x = "Depth (m)", y = "Temperature (Â°C)")

# Three or more variables: length vs depth with size for weight
ggplot(data = data_lionfish, aes(x = depth_m, y = total_length_mm, 
                                 size = total_weight_gr)) +
  geom_point(alpha = 0.7) +
  scale_size_continuous(range = c(1, 5)) +
  scale_color_viridis_c() +
  labs(x = "Depth (m)", y = "Total length (mm)", 
       size = "Weight (g)")
```

# Part 4: Modifying colors

```{r}
p <- ggplot(data = data_lionfish, aes(x = depth_m, y = total_length_mm, 
                                      color = temperature_C)) +
  geom_point(alpha = 0.7)

p
```

- The easiest way is to use `scale_*viridis_*`
  - Check documentation
  - An example

```{r}
p + 
  scale_color_viridis_c()
```


- `scale_color_gradientn` for continuous and custom palette
  - Check documentation
  - An example


```{r}
p +
  scale_color_gradientn(colours = palette_IPCC(var = "temp", type = "seq"))
```

- `scale_color_gradient` vs `scale_color_gradient2` for continuous / divergent with ends
  - Check documentation
  - An example

```{r}
# Green to orange
p +
  scale_color_gradient(low = "green",
                       high = "orange")

# Going through white
p +
  scale_color_gradient2(low = "green",
                       mid = "white",
                       high = "orange")

# Set white at 0
p +
  scale_color_gradient2(low = "green",
                       mid = "white",
                       high = "orange",
                       midpoint = 120)
```

- `scale_color_manual` for discrete
  - Check documentation
  - An example
  
```{r}
p <- ggplot(data = data_milton,
            aes(x = iso_time, y = wind_speed, color = sshs)) +
  geom_point()

p

p +
  scale_color_manual(values = palette_UM(n = 10))

p + 
  scale_color_viridis_d()
```

- `scale_*_manual`

```{r}
# Example with manual color scale for discrete variables
ggplot(data = data_lionfish, aes(x = site, fill = size_class)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(values = c("small" = "lightblue", 
                               "medium" = "blue", 
                               "large" = "darkblue")) +
  labs(x = "Site", y = "Number of fish", fill = "Size class")
```


# Part 5: Extra material if time allows

## Saving plots

- Repeat the entire process, one line at a time, showing how to save to an object
- Then show how to save plot with ggsave
- Show documentation of ggsave
- Emphasize on creating plot objects

```{r}
# Save plot to object
p <- ggplot(data = data_lionfish,
            mapping = aes(x = depth_m, y = total_length_mm)) +
  geom_point(shape = 21, fill = "steelblue", size = 2) +
  labs(x = "Depth (m)",
       y = "Total length (mm)",
       title = "Body length and depth")

```

```{r}
#| eval: false
# Save plot to file
ggsave("lionfish_depth_length.png", p, width = 8, height = 6, dpi = 300)
```


## Layering
- Show `data_milton` documentation again
- Build plot below
- Show use of `color` vs `fill` inside main `aes()` (affecting line and points) vs `aes()` inside `geom_point()` (affecting only the poitns)

```{r}
p <- ggplot(data = data_milton,
            mapping = aes(x = iso_time,
                          y = pressure,
            )) +
  geom_line() +
  geom_point(aes(color = wind_speed),
             size = 2) 

p +
  scale_color_gradientn(colours = palette_IPCC(var = "wind", type = "seq"))
```

## Facetting

- Show documentation for `facet_wrap` and `facet_grid`
- Show how each of these work

```{r}
# Facet wrap example
ggplot(data = data_lionfish, aes(x = depth_m, y = total_length_mm)) +
  geom_point() +
  facet_wrap(~size_class, ncol = 3) +
  labs(x = "Depth (m)", y = "Total length (mm)")

# Facet grid example
ggplot(data = data_lionfish, aes(x = depth_m, y = total_length_mm)) +
  geom_point() +
  facet_grid(size_class ~ site) +
  labs(x = "Depth (m)", y = "Total length (mm)")

# Facet wrap with different scales
ggplot(data = data_lionfish, aes(x = depth_m, y = total_length_mm)) +
  geom_point() +
  facet_wrap(~size_class, ncol = 3, scales = "free_y") +
  labs(x = "Depth (m)", y = "Total length (mm)")
```


