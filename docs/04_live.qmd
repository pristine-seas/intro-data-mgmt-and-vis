---
title: "Coding Principles Exercises"
lightbox: true
format:
  html:
    toc: true
  pdf:
    documentclass: article
---

```{r}
#| echo: false
#| warnings: false
#| message: false
library(EVR628tools)
library(tidyverse)
```

# Set up

1. Open R Studio and navigate to you EVR628 project
2. Set up a code snippet for comments
3. Create a new R script and save it as `objects_and_classes.R`
4. Add a comment at the top of your script with the date and title

# Exercise 1: Object Classes and Assignment (15 minutes)

## Part A: Create and Check Object Classes

In your R Script, create objects of different classes and check their types:

1. A character object called `my_name` with your name
2. A numeric object called `my_age` with your age (or any number, it doesn't have to be your age)
3. A logical object called `is_student` with TRUE or FALSE

Then, in the console, check the class of each object using `class()`

```{r}
# My code will be here

```

## Part B: Object Coercion

Let's see what happens when you try converting objects. In the R script, write and then execute code that will: 

1. Convert your age to character using `as.character(my_age)`
2. Convert TRUE to numeric using `as.numeric()`
3. Try to convert `"hello"` to numeric - what happens?
4. Use `|>` to build a code pipeline to:
    a. Take your age
    b. Convert it to character
    c. Get it's class

```{r}
# My code will be here

```

# Exercise 2: Vectors and Operations (20 minutes)

## Part A: Create and Manipulate Vectors

1. Clean you environment (use the broom icon)
2. Create a numeric vector called `length_m` with values: 6, 4.1, 2.8, 5.5, 3.9, 5.8
3. Create a character vector called `shark_species` with: Great White Shark, Lemon Shark, Bull Shark, Hammerhead Shark, Mako Shark, and Great White Shark (yes, again)
4. How many _variables_ do you have in your environment?
5. How many _observations_ do we have? Find the length of both vectors using `length()`
6. How many _species_ do we have? (Hint, use `|>` to build a pipeline)
7. Calculate the mean length using `mean()`
8. Find the maximum length using `max()`

```{r}
# My code will be here

```

::: {.callout-important}
- When passing arguments to functions, use `=` not `<-`
- When creating objects, use `<-` not `=`
:::


## Part B: Vector Operations and Indexing

1. Extract the first 3 shark species using indexing with `[]` and save them to an object called `first_3`
2. Extract shark species where maximum length is greater than 4 meters
3. Create a logical vector showing which sharks have max length above 4 meters
4. Assuming the values in `length_m` and `sharks_species` are ordered so that they match each other, find the shark species that is the largest

```{r}
# My code will be here

```

## Part C (Extra): Another carrot: `rfishbase`

1. Install the package with: `install.packages("rfisbhase")`
2. Use the `first_3` object to get the plausible scientific names of the sharks with `rfishbase::common_to_sci()`
3. Save the results into an object called `shark_sci_names`
4. What is the `class()` of `shark_sci_names`

```{r}
# My code will be here

```

--------------------------- Likely pause here ---------------------------

# Exercise 3: Data Frames and Tibbles (15 minutes)

## Part A: Estimate the effect of a Marine Protected Area on Biomass

Create four objects containing:

1. The average biomass inside the MPA before it was protected
2. The average biomass inside the MPA after it was protected
3. The average biomass outside the MPA before the MPA was created
4. The average biomass outside the MPA after the MPA was created

Then, calculate:

5. Change after vs before for the protected site
6. Change after vs before for the unprotected site

Finally:

7. The difference between these two sites

This is called the *naive* difference-in-differences estimate. See @villasenor2018user and @lynham2024evidence for details.


```{r}
#| include: false
library(EVR628tools)
library(tidyverse)
data("data_MPA")

ggplot(data_MPA, aes(x = time, y = biomass, color = protected == 1)) + 
  geom_point() +
  geom_smooth()

ggplot(data_MPA, aes(x = after, y = biomass, color = protected == 1)) +
  stat_summary(geom = "pointrange", fun.data = "mean_se",
               position = position_dodge(width = 0.25))

## Manually calculate DiD ------------------------------------------------------
mean_protected_before <- mean(data_MPA$biomass[data_MPA$protected == 1 & data_MPA$after == 0])
mean_protected_after <- mean(data_MPA$biomass[data_MPA$protected == 1 & data_MPA$after == 1])
mean_control_before <- mean(data_MPA$biomass[data_MPA$protected == 0 & data_MPA$after == 0])
mean_control_after <- mean(data_MPA$biomass[data_MPA$protected == 0 & data_MPA$after == 1])

# Difference in time for each site
dif_protected <- mean_protected_after - mean_protected_before
dif_control <- mean_control_after - mean_control_before

# Differences across sites
dif_in_dif <- dif_protected - dif_control

dif_in_dif

lm(biomass ~ after + protected + after * protected,
      data = data_MPA) |> 
  summary()
```

```{r}
# My code will be here

```

# Exercise 4: Building Functions (15 minutes)

## Part A: Create Your Own Function

1. Create a function called `did` that takes three vectors:
   - `after`
   - `treated`
   - and `outcome`
2. Calculates a DiD estimate
3. Test your function using the `data_MPA`

```{r}
# My code will be here

```

# Exercise 5: Code Style and Documentation (10 minutes)

## Part A: Fix Code Style

Fix the style issues in this code:
```r
myfunction<-function(x,y){
result=x+y*2
return(result)
}
mydataframe=data.frame(species=c("Great White","Tiger"),length=c(4.5,3.2))
mean(mydataframe$length,na.rm=TRUE)
```

```{r}
# My improved code will be here

```

## Part B: Add Comments and Section Headers

Take your shark analysis from Exercise 5 and:
1. Add section headers with `###`
2. Add meaningful comments explaining what each step does
3. Add a comment explaining WHY you're doing the analysis
4. Make sure your code follows good naming conventions
