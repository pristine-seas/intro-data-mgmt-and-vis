---
title: "Coding Principles Exercises"
lightbox: true
format:
  html:
    toc: true
  pdf:
    documentclass: article
---

```{r}
#| echo: false
#| warnings: false
#| message: false
library(EVR628tools)
library(tidyverse)
```

# Exercise 1: Object Classes and Assignment

## Part A: Set up

1. Open R Studio and navigate to your EVR628 project
2. Set up a code snippet for a header

```r
################################################################################
# title
################################################################################
#
# Your Name Here
# Your email here
# date
#
# Description
#
################################################################################
```

3. Create a new R script and save it as `objects_and_classes.R`
4. Use your new code snippet to add the header

## Part B: Create and Check Object Classes

In your R Script, create objects of different classes and check their types:

1. A character object called `my_name` with your name
2. A numeric object called `my_age` with your age (or any number, it doesn't have to be your age)
3. A logical object called `is_student` with TRUE or FALSE
4. Check the class of each object using `class()`

```{r}
my_name <- "JC" # character object called `my_name` with your name
my_age <- 32 # numeric object called `my_age` with your age
is_student <- FALSE # logical object called `is_student` with TRUE or FALSE

# Check the class of each object using `class()`
class(my_name)
class(my_age)
class(is_student)
```

## Part C: Object Coercion

Let's see what happens when you try converting objects. In the R script, write and then execute code that will: 

1. Convert your age to `character` using `as.character(my_age)`
2. Convert `TRUE` to numeric using `as.numeric()`
3. Try to convert `"hello"` to `numeric` - what happens?
4. Advanced: Use `|>` to build a code pipeline to:
    a. Take your age
    b. Convert it to character
    c. Get it's class

```{r}
# Note that I am overwriting the object. If I had only done `as.character(my_age)`,
# then the coerced output would have been printed to the console.
my_age <- as.character(my_age) # Convert your age to `character`
# Check that iw worked
class(my_age)
as.numeric(TRUE) # Convert `TRUE` to numeric using `as.numeric()`
as.numeric("hello") # Try to convert `"hello"` to `numeric` - what happens?

# Build a pipeline
my_age <- 32 # Start with my_age as numeric again
# ANd now build the pipeline
my_age |> 
  as.character() |> 
  class()
```

# Exercise 2: Vectors and Operations

## Part A: Create and Manipulate Vectors

1. Clean you environment (use the broom icon)
2. Create a numeric vector called `length_m` with values: 6, 4.1, 2.8, 5.5, 3.9, 5.8
3. Create a character vector called `shark_species` with: Great White Shark, Lemon Shark, Bull Shark, Hammerhead Shark, Mako Shark, and Great White Shark (yes, white shark again)
4. How many _variables_ do you have in your environment?
5. How many length _observations_ do we have? Find the length of both vectors using `length()`
6. How many unique _species_ do we have? (Hint, use `|>` to build a pipeline)
7. Calculate the mean length of all sharks using `mean()`
8. Find the maximum length using `max()`

```{r}
# My code will be here

```

::: {.callout-important}
- When passing arguments to functions, use `=` not `<-`
- When creating objects, use `<-` not `=`
:::


## Part B: Vector Operations and Indexing

1. Extract the first 3 shark species using indexing with `[]` and save them to an object called `first_3`
2. Extract shark species where maximum length is greater than 4 meters
3. Create a logical vector showing which sharks have max length above 4 meters
4. Assuming the values in `length_m` and `sharks_species` are ordered so that they match each other, find the shark species that is the largest
5. Calculate the mean length for all creat whites sharks

```{r}
# My code will be here

```

---

Likely pause here

---

# Exercise 3: Data Frames and Tibbles

## Part A: Estimate the effect of a Marine Protected Area on Biomass

1. Install and load an updated version of `EVR628tools`:

``` r
remotes::install_github("jcvdav/EVR628tools")
```

2. Start a new script called `MPA_analysis`, add a comment outline and then load the `EVR628tools` and `tidyverse` packages.

3. Load and inspect the new `?data_MPA`
    a. What are the dimensions of the data?
    b. What are the column names?col
    c. How many `unique()` sites are there?
    b. How many `unique()` years?

4. Create four objects containing:
    a. Mean biomass inside the MPA before it was protected
    b. Mean biomass inside the MPA after it was protected
    c. Mean biomass outside the MPA before the MPA was created
    d. Mean biomass outside the MPA after the MPA was created

Hint: Use a combination of subsetting (`[ ]`), relational (`==`), and logical operators (`&`)

5. Then, calculate:
    a. Change after vs before for the protected site
    b. Change after vs before for the unprotected site

6. Finally, calculate the difference between these two values. This is called the *naive* difference-in-differences estimate. You are calculating the differences across treatments and across time. See @villasenor2018user and @lynham2024evidence for details.


```{r}
#| include: false
library(EVR628tools)
library(tidyverse)
data("data_MPA")

ggplot(data_MPA, aes(x = time, y = biomass, color = protected == 1)) + 
  geom_point() +
  geom_smooth()

ggplot(data_MPA, aes(x = after, y = biomass, color = protected == 1)) +
  stat_summary(geom = "pointrange", fun.data = "mean_se",
               position = position_dodge(width = 0.25))

## Manually calculate DiD ------------------------------------------------------
mean_protected_before <- mean(data_MPA$biomass[data_MPA$protected == 1 & data_MPA$after == 0])
mean_protected_after <- mean(data_MPA$biomass[data_MPA$protected == 1 & data_MPA$after == 1])
mean_control_before <- mean(data_MPA$biomass[data_MPA$protected == 0 & data_MPA$after == 0])
mean_control_after <- mean(data_MPA$biomass[data_MPA$protected == 0 & data_MPA$after == 1])

# Difference in time for each site
dif_protected <- mean_protected_after - mean_protected_before
dif_control <- mean_control_after - mean_control_before

# Differences across sites
dif_in_dif <- dif_protected - dif_control

dif_in_dif

lm(biomass ~ after + protected + after * protected,
      data = data_MPA) |> 
  summary()
```

```{r}
# My code will be here

```

\clearpage

# Exercise 4: Code Style and Documentation

## Part A: Fix Code Style

Fix the style issues in this code:

```r
mydataframe=data.frame(species=c("Great White","Tiger", "Bull"),
length=c(4.5,3.2, NA))
mean(mydataframe$length,na.rm=TRUE)
```

```{r}
# My improved code will be here

```

Note: What's with than `na.rm = TRUE`?

## Part B: Add Comments and Section Headers

1. Add meaningful comments to your R script
